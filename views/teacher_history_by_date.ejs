<!DOCTYPE html>
<html lang="th">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>ประวัติการเช็คชื่อ (รายวัน)</title>
  <link rel="stylesheet" href="/style.css" />
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body>
  <% if (showNavbar) { %>
    <%- include('partials/navbar', { currentUser, currentRole }) %>
  <% } %>

  <div class="container mt-5 pt-4 mb-4">
    <!-- หัวข้อหลัก -->
    <h2 class="text-center mb-4">รายงาน ประวัติการเช็คชื่อของผู้เรียน (รายวัน)</h2>

    <!-- ค้นหาวันที่ -->
    <form class="row g-2 mb-4 justify-content-center align-items-center"
          method="get" action="/classroom/<%= classroom.classroomid %>/history">
      <div class="col-auto">
        <label class="col-form-label">ค้นหาวันที่:</label>
      </div>
      <div class="col-auto">
        <input type="date" class="form-control" name="date" value="<%= selectedDate %>" required>
      </div>
      <div class="col-auto">
        <button class="btn btn-primary" type="submit">แสดงผล</button>
      </div>
      <div class="col-auto">
        <a class="btn btn-secondary" href="/classroom/view/<%= classroom.classroomid %>">ย้อนกลับ</a>
      </div>
    </form>

    <% if (!hasAnyAttendance) { %>
      <div class="alert alert-info text-center my-4">
        ไม่มีผลการเช็คชื่อในวันที่ <%= displayDate %>
      </div>
    <% } else { %>

      <!-- สรุปตามรูปที่ 2 -->
      <div class="text-center mb-4">
        <div class="fs-5 fw-semibold mb-1">
          ชื่อชั้นเรียน <span class="text-dark"><%= classroom.classroomname %></span>
        </div>
        <div class="fs-6">
          วันที่ <span class="fw-bold"><%= displayDate %></span>
        </div>
        <div class="d-flex justify-content-center gap-2 mt-2 flex-wrap">
  <span class="badge rounded-pill text-bg-success px-3 py-2">
    มาเรียน: <%= presentCount %>
  </span>
  <span class="badge rounded-pill text-bg-primary px-3 py-2">
    ตรงเวลา: <%= onTimeCount %>
  </span>
  <span class="badge rounded-pill text-bg-warning px-3 py-2">
    มาสาย: <%= lateCount %>
  </span>
  <span class="badge rounded-pill text-bg-danger px-3 py-2">
    ขาดเรียน: <%= absentCount %>
  </span>
</div>

      </div>
      <div class="table-responsive mt-3">
      <table class="table table-bordered">
        <thead class="table-secondary">
          <tr>
            <th style="width:140px;">รหัสประจำตัว</th>
            <th>ชื่อ</th>
            <th>นามสกุล</th>
            <th style="width:120px;">เวลา</th>
            <th style="width:180px;">สถานะการเช็คเรียน</th>
          </tr>
        </thead>
        <tbody>
          <% students.forEach(s => { %>
            <tr>
              <td><%= s.studentid %></td>
              <td><%= s.firstname %></td>
              <td><%= s.surname %></td>
              <td><%= s.checkin_time || '-' %></td>
              <td class="text-center">
  <% if (s.status === 'Present') { %>
    <span class="badge rounded-pill text-bg-success px-4">มาเรียน</span>
  <% } else if (s.status === 'Late') { %>
    <span class="badge rounded-pill text-bg-warning px-4">มาสาย</span>
  <% } else { %>
    <span class="badge rounded-pill text-bg-danger px-4">ขาดเรียน</span>   
  <% } %>
</td>

            </tr>
          <% }) %>
        </tbody>
      </table>
      </div>
    <% } %>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>
