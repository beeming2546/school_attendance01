<!DOCTYPE html>
<html lang="th">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>ประวัติการเช็คชื่อ (รายวัน)</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body>
  <% if (showNavbar) { %>
    <%- include('partials/navbar', { currentUser, currentRole }) %>
  <% } %>

  <div class="container my-4">
    <h3 class="mb-3 text-center">รายงานประวัติการเช็คชื่อของผู้เรียน (รายวัน)</h3>

    <!-- ค้นหาวันที่ -->
    <form class="row g-2 mb-4" method="get" action="/classroom/<%= classroom.classroomid %>/history">
      <div class="col-auto">
        <label class="col-form-label">ค้นหาวันที่:</label>
      </div>
      <div class="col-auto">
        <input type="date" class="form-control" name="date" value="<%= selectedDate %>" required>
      </div>
      <div class="col-auto">
        <button class="btn btn-primary" type="submit">แสดงผล</button>
      </div>
      <div class="col-auto">
        <a class="btn btn-secondary" href="/classroom/view/<%= classroom.classroomid %>">ย้อนกลับ</a>
      </div>
    </form>
<% if (!hasAnyAttendance) { %>
  <div class="alert alert-info text-center my-4">
    ไม่มีผลการเช็คชื่อในวันที่ <%= displayDate %>
  </div>
<% } else { %>
    <div class="border p-3 mb-4">
  <p class="mb-1"><strong>ชื่อชั้นเรียน:</strong> <%= classroom.classroomname %></p>
  <p class="mb-1"><strong>วันที่:</strong> <%= displayDate %></p>
  <p class="mb-1"><strong>จำนวนที่มา:</strong> <%= presentCount %></p>
  <p class="mb-1"><strong>จำนวนที่ขาด:</strong> <%= absentCount %></p>
</div>


  <table class="table table-bordered">
    <thead class="table-light">
      <tr>
        <th style="width:140px;">รหัสประจำตัว</th>
        <th>ชื่อ</th>
        <th>นามสกุล</th>
        <th style="width:120px;">เวลา</th>
        <th style="width:180px;">สถานะการเช็คเรียน</th>
      </tr>
    </thead>
    <tbody>
      <% students.forEach(s => { %>
        <tr>
          <td><%= s.studentid %></td>
          <td><%= s.firstname %></td>
          <td><%= s.surname %></td>
          <td><%= s.checkin_time || '-' %></td>
          <td>
            <% if (s.status === 'Present') { %>
              <span class="text-success fw-bold">มาเรียน</span>
            <% } else { %>
              <span class="text-danger fw-bold">ขาดเรียน</span>
            <% } %>
          </td>
        </tr>
      <% }) %>
    </tbody>
  </table>
<% } %>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>
