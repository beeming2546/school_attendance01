<!DOCTYPE html>
<html lang="th">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css" rel="stylesheet" />
  <link rel="stylesheet" href="/style.css" />
  <title>เพิ่ม <%= role === 'admin' ? 'ผู้ดูแลระบบ' : (role === 'teacher' ? 'ครู' : 'นักเรียน') %></title>
  <script>
    function validateForm() {
      const form = document.forms["addForm"];
      const role = "<%= role %>";
      const requiredFields = ["id", "firstname", "username", "password", "confirm_password"];

      if (role !== 'admin') {
        requiredFields.push("surname");
        requiredFields.push("email");
      }

      for (let field of requiredFields) {
        if (!form[field].value.trim()) {
          alert("กรุณากรอกข้อมูลให้ครบทุกช่อง");
          return false;
        }
      }

      if (form["password"].value !== form["confirm_password"].value) {
        alert("รหัสผ่านและยืนยันรหัสผ่านไม่ตรงกัน");
        return false;
      }

      return confirm("คุณต้องการบันทึกข้อมูลนี้ใช่หรือไม่?");
    }
  </script>
  <style>
    .required {
      color: red;
      font-weight: bold;
      margin-left: 2px;
    }
    .btn-group {
      display: flex;
      justify-content: center;
      gap: 15px;
      margin-top: 25px;
    }
    .btn-group button,
    .btn-group a.btn {
      min-width: 150px;
    }
  </style>
</head>
<body>
  <% if (showNavbar) { %>
    <%- include('partials/navbar') %>
  <% } %>

  <div class="container" style="max-width: 600px; margin: 20px auto; padding: 0 15px;">
    <h2>เพิ่ม <%= role === 'admin' ? 'ผู้ดูแลระบบ' : (role === 'teacher' ? 'ครู' : 'นักเรียน') %></h2>
    <% if (typeof error !== 'undefined' && error) { %>
  <p style="color:red; text-align:center;"><%= error %></p>
<% } %>

    <form name="addForm" action="/admin/add/<%= role %>" method="POST" onsubmit="return validateForm()">
      <div class="form-row">
        <label>รหัสประจำตัว:</label>
        <input type="text" name="id" required><span class="required">*</span>
      </div>
      <small class="note">
        รูปแบบเป็นตัวเลขเท่านั้น เช่น 9999999
        </small>

      <div class="form-row">
        <label>ชื่อ:</label>
        <input type="text" name="firstname" required><span class="required">*</span>
      </div>

      <% if (role !== 'admin') { %>
        <div class="form-row">
          <label>นามสกุล:</label>
          <input type="text" name="surname" required><span class="required">*</span>
        </div>
      <% } %>

      <div class="form-row">
        <label>ชื่อผู้ใช้:</label>
        <input type="text" name="username" required><span class="required">*</span>
      </div>

      <div class="form-row">
        <label>รหัสผ่าน:</label>
        <input type="password" name="password" required><span class="required">*</span>
      </div>

      <div class="form-row">
        <label>ยืนยันรหัสผ่าน:</label>
        <input type="password" name="confirm_password" required><span class="required">*</span>
      </div>

      <% if (role !== 'admin') { %>
        <div class="form-row">
          <label>อีเมล:</label>
          <input type="email" name="email" required><span class="required">*</span>
        </div>
      <% } %>

      <div class="btn-group">
        <button type="submit" class="btn btn-primary">บันทึก</button>
        <a href="/admin/list/<%= role %>" class="btn btn-secondary">ย้อนกลับ</a>
      </div>
    </form>
  </div>
</body>
</html>
